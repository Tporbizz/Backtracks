{% extends "base.html" %}

{% block title %}‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô - BackTracks{% endblock %}

{% block content %}
<div class="container">
    <h1 class="h4 mb-3">‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
    
    <!-- Job Tabs -->
    <ul class="nav nav-tabs mb-4" id="jobTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active" type="button" role="tab">
                ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="booked-tab" data-bs-toggle="tab" data-bs-target="#booked" type="button" role="tab">
                ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
            </button>
        </li>
    </ul>
    
    <div class="tab-content" id="jobTabsContent">
        <!-- Active Jobs -->
        <div class="tab-pane fade show active" id="active" role="tabpanel" aria-labelledby="active-tab">
            {% set active_trucks = trucks|selectattr('is_confirmed', 'eq', false)|list %}
            
            {% if active_trucks|length > 0 %}
                {% for truck in active_trucks %}
                    <div class="truck-card">
                        <div class="truck-card-header">
                            <div>
                                <div class="truck-route">{{ truck.start }} ‚Üí {{ truck.dest }}</div>
                                <div class="truck-details">
                                    {{ truck.truck_type }} ‚Ä¢ ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: {{ truck.plate }} ‚Ä¢ 
                                    ‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ truck.return_date }}
                                </div>
                            </div>
                            <div class="truck-price">
                                {{ "{:,}".format(truck.price) }}‡∏ø
                            </div>
                        </div>
                        
                        <div class="truck-actions mt-2">
                            <form method="POST" action="{{ url_for('confirm_truck', truck_id=truck.id) }}">
                                <button type="submit" class="btn btn-primary btn-sm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</button>
                            </form>
                            <a href="{{ url_for('edit_truck', truck_id=truck.id) }}" class="btn btn-outline btn-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                            <form method="POST" action="{{ url_for('delete_truck', truck_id=truck.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-outline btn-sm" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ô‡∏µ‡πâ?')">‡∏•‡∏ö</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-info">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà</div>
            {% endif %}
        </div>
        
        <!-- Booked Jobs -->
        <div class="tab-pane fade" id="booked" role="tabpanel" aria-labelledby="booked-tab">
            {% set booked_trucks = trucks|selectattr('is_confirmed', 'eq', true)|list %}
            
            {% if booked_trucks|length > 0 %}
                {% for truck in booked_trucks %}
                    <div class="truck-card booked">
                        <div class="truck-card-header">
                            <div>
                                <div class="truck-route">{{ truck.start }} ‚Üí {{ truck.dest }}</div>
                                <div class="truck-details">
                                    {{ truck.truck_type }} ‚Ä¢ ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: {{ truck.plate }} ‚Ä¢ 
                                    <span class="booked-badge">‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                                </div>
                            </div>
                            <div class="truck-price confirmed">
                                {{ "{:,}".format(truck.price) }}‡∏ø
                            </div>
                        </div>
                        
                        <div class="truck-job-info mt-2">
                            <p>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" if truck.is_new else "‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ" }}</p>
                        </div>
                        
                        <div class="truck-actions mt-2">
                            <button class="btn btn-primary btn-sm">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</button>
                            <button class="btn btn-outline btn-sm">‡∏î‡∏π‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</button>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-info">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
            {% endif %}
        </div>
    </div>
    
    <!-- No Jobs Message -->
    {% if trucks|length == 0 %}
        <div class="empty-jobs text-center mt-4">
            <div class="empty-icon mb-3">üìã</div>
            <h3 class="h5">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</h3>
            <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "+" ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</p>
            <a href="{{ url_for('add_truck') }}" class="btn btn-primary mt-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</a>
        </div>
    {% endif %}
</div>
{% endblock %}